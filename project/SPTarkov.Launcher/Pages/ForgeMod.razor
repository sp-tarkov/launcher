@page "/ForgeMod/{ModId}"

@inject HttpHelper HttpHelper
@inject LogHelper LogHelper

<MudContainer Class="px-8 mt-2 mb-6 pa-0" MaxWidth="MaxWidth.Large">
    <MudGrid>
        @if (searchResponse is null || searchInProgress)
        {
            <DetailedModComponent IsSkeleton="true"/>
        }
        else if (searchResponse?.Data is not null)
        {
            <DetailedModComponent ForgeMod="@searchResponse?.Data"/>
        }
    </MudGrid>
</MudContainer>

@code {
    private ForgeModResponse searchResponse { get; set; }
    private bool searchInProgress { get; set; }

    [Parameter]
    public string ModId { get; set; }

    protected override async void OnInitialized()
    {
        await SearchForMod();
        base.OnInitialized();
    }

    private async Task SearchForMod()
    {
        searchInProgress = true;

        try
        {
            var token = new CancellationTokenSource(TimeSpan.FromSeconds(10));
            searchResponse = await HttpHelper.ForgeGetMod(ModId, token.Token);
        }
        catch (Exception e)
        {
            LogHelper.AddLog("Exception thrown from ForgeHelper.SearchForMod");
            LogHelper.AddLog(e.ToString());
            return;
        }

        searchInProgress = false;
        StateHasChanged();
    }
}
