@inherits LayoutComponentBase
@implements IDisposable

@inject IJSRuntime JsRuntime
@inject ConfigHelper ConfigHelper
@inject StateHelper StateHelper

<MudThemeProvider IsDarkMode="true"/>
<MudPopoverProvider/>
<MudSnackbarProvider/>
<MudDialogProvider/>
<MudFab id="scrollTopBtn" Color="Color.Primary" StartIcon="@Icons.Material.Filled.ArrowCircleUp" Class="fixed z-90" Style="bottom: 10px; right: 10px; display: none;" @onclick="ScrollToTop" Size="Size.Small"/>
@if (StateHelper.ShowBackground)
{
    <MudContainer Class="no-select overlay-container unset absolute">
        <MudImage Src="./bg.png" Class="no-select fixed mud-height-full mud-width-full background-image-cover"/>
        <div class="no-select fixed mud-height-full mud-width-full background-overlay"></div>
    </MudContainer>
}

<MudLayout>
    <MudDrawer Width="150px" ClipMode="DrawerClipMode.Never" Elevation="5" Variant="@DrawerVariant.Mini" OpenMiniOnHover="false" Breakpoint="Breakpoint.None" Class="mud-background-gray border-r-2 border-solid mud-border-lines-default">
        <NavMenu/>
    </MudDrawer>
    <MudMainContent Class="pt-1 pb-2">
        @Body
    </MudMainContent>
</MudLayout>

@code {
    protected override void OnInitialized()
    {
        StateHelper.OnStateChanged += StateHasChanged;
        base.OnInitialized();
    }

    public void Dispose()
    {
        StateHelper.OnStateChanged -= StateHasChanged;
    }

    private async Task ScrollToTop()
    {
        await JsRuntime.InvokeVoidAsync("scrollToTopSmooth");
    }
}
