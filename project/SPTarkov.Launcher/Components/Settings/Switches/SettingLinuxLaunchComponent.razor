@inject ConfigHelper ConfigHelper

<MudContainer Class="pa-0">
    <MudLink Color="Color.Default" Underline="Underline.None" Disabled="Disabled" Class="@(GetLinkClasses())">
        <MudTextField @bind-Value="NewValue" Label="Launch Settings" Variant="Variant.Outlined" Immediate="true" Margin="Margin.Dense" Placeholder="MANGOHUD=1"/>
        <MudIconButton Color="@(NewValue == OldValue ? Color.Default : Color.Success)" Icon="@Icons.Material.Filled.Save" Disabled="@(NewValue == OldValue)" OnClick="OnTextSaved" />
    </MudLink>
</MudContainer>
@if (AddDiv)
{
    <MudDivider DividerType="DividerType.Middle" Class="ma-0"/>
}

@code {
    // TODO: Add validation to this

    protected override Task OnInitializedAsync()
    {
        OldValue = ConfigHelper.GetConfig().LinuxSettings.LaunchSettings;
        NewValue = $"{OldValue}";

        return base.OnInitializedAsync();
    }

    private string GetLinkClasses()
    {
        var classes = new CssBuilder()
            .AddClass("d-flex")
            .AddClass("justify-center")
            .AddClass("align-center")
            .AddClass("py-2")
            .AddClass("pl-5");

        if (!Disabled)
        {
            classes.AddClass("cursor-pointer").AddClass("setting-on-hover");
        }

        return classes.Build();
    }

    private string OldValue { get; set; }
    private string NewValue { get; set; }

    [Parameter] public bool Disabled { get; set; }

    [Parameter] public bool AddDiv { get; set; }

    private void OnTextSaved()
    {
        OldValue = NewValue;
        ConfigHelper.SetLinuxLaunchSettings(NewValue);
        StateHasChanged();
    }
}
