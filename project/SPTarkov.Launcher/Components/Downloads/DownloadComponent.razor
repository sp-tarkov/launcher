@inject DownloadHelper DownloadHelper

@implements IDisposable


<MudContainer Class="download-box px-0 border-2 border-solid mud-border-lines-default mud-elevation-1" MaxWidth="MaxWidth.Small">
    <MudContainer Class="relative pa-1">
        @foreach (var (name, item) in DownloadHelper.GetDownloadTasks())
        {
            <MudLink Class="setting-on-hover pa-1 d-inline-block mud-width-full d-flex flex-row" Underline="Underline.None" Color="Color.Default">

                <MudContainer Class="d-flex flex-row pa-0">
                    <MudContainer Class="text-overflow py-2 px-1">
                        <MudText HtmlTag="span">
                            @name
                        </MudText>
                        <MudProgressLinear Rounded="true" Color="Color.Info" Size="Size.Small" Value="@item.Progress" Min="0" Max="100" Class="mt-2">
                            <ChildContent>
                                <MudText Color="Color.Default" Class="progress-bar">@item.Progress%</MudText>
                            </ChildContent>
                        </MudProgressLinear>
                    </MudContainer>
                    @if (item.Complete)
                    {
                        <MudTooltip Arrow="false" ShowOnHover="true" ShowOnFocus="false" ShowOnClick="false" Text="Close" Placement="Placement.Left">
                            <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Remove" Color="Color.Info" OnClick="() => DownloadHelper.CloseDownloadTask(name)"/>
                        </MudTooltip>
                    }
                    else
                    {
                        <MudTooltip Arrow="false" ShowOnHover="true" ShowOnFocus="false" ShowOnClick="false" Text="Cancel" Placement="Placement.Left">
                            <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Cancel" Color="Color.Error" OnClick="() => DownloadHelper.CancelDownloadTask(name)"/>
                        </MudTooltip>
                    }
                </MudContainer>

            </MudLink>
        }
    </MudContainer>
</MudContainer>


@code {

    private Timer _progressTimer;

    protected override Task OnAfterRenderAsync(bool firstRender)
    {
        _progressTimer = new Timer((_) => { InvokeAsync(StateHasChanged); }, default, TimeSpan.FromSeconds(2), TimeSpan.Zero);
        return base.OnAfterRenderAsync(firstRender);
    }

    public void Dispose()
    {
        _progressTimer?.Dispose();
    }

}

@* <MudLink Class="setting-on-hover pa-1" Underline="Underline.None" Color="Color.Default"> *@
@* </MudLink> *@
