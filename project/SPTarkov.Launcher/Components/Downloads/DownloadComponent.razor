@inject DownloadHelper DownloadHelper

@implements IDisposable


<MudContainer Class="download-box px-0 border-2 border-solid mud-border-lines-default mud-elevation-1" MaxWidth="MaxWidth.Small">
    <MudGrid Class="relative" Style="left: 80px !important;">
        <MudItem sm="12" Class="d-flex flex-row justify-end align-content-end">
            <MudIconButton Icon="@Icons.Material.Filled.Close" Color="Color.Default"/>
        </MudItem>
        @foreach (var (name, item) in DownloadHelper.GetDownloadTasks())
        {
            <MudLink Class="setting-on-hover" Style="display: inline-block;" Underline="Underline.None" Color="Color.Default">
                <MudGrid Class="d-flex flex-row pa-0">
                    <MudItem sm="10" Class="text-overflow pa-2">
                        <MudText HtmlTag="span">@name</MudText>
                        <MudProgressLinear Rounded="true" Color="Color.Info" Size="Size.Small" Value="@item.Progress" Min="0" Max="100" Class="mt-2">
                            <ChildContent>
                                <MudText Color="Color.Default">@item.Progress%</MudText>
                            </ChildContent>
                        </MudProgressLinear>
                    </MudItem>
                    <MudItem sm="2" Class="d-flex justify-center align-items-center align-center">
                        @if (item.Complete)
                        {
                            <MudTooltip Arrow="false" ShowOnHover="true" ShowOnFocus="false" ShowOnClick="false" Text="Close" Placement="Placement.Left">
                                <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Remove" Color="Color.Info" OnClick="() => DownloadHelper.CloseDownloadTask(name)"/>
                            </MudTooltip>
                        }
                        else
                        {
                            <MudTooltip Arrow="false" ShowOnHover="true" ShowOnFocus="false" ShowOnClick="false" Text="Cancel" Placement="Placement.Left">
                                <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Cancel" Color="Color.Error" OnClick="() => DownloadHelper.CancelDownloadTask(name)"/>
                            </MudTooltip>
                        }
                    </MudItem>
                </MudGrid>
            </MudLink>
        }
    </MudGrid>
</MudContainer>


@code {

    private Timer _progressTimer;

    protected override Task OnAfterRenderAsync(bool firstRender)
    {
        _progressTimer = new Timer((_) => { InvokeAsync(StateHasChanged); }, default, TimeSpan.FromSeconds(2), TimeSpan.Zero);
        return base.OnAfterRenderAsync(firstRender);
    }

    public void Dispose()
    {
        _progressTimer?.Dispose();
    }

}

@* <MudLink Class="setting-on-hover pa-1" Underline="Underline.None" Color="Color.Default"> *@
@* </MudLink> *@
